---
import { graphql } from "gql.tada";
import ContentLayout from "../../layouts/ContentLayout.astro";
import { client } from "../../utils/graphql-client";
import SpeakerDetail, {
	speakerDetailFragment,
} from "../../components/SpeakerDetail.astro";
import TalkDetail from "../../components/TalkDetail.astro";

const { speaker: slug } = Astro.params;

const query = graphql(
	`
		query GetSpeaker($slug: String!) {
			detail: speakerCollection(limit: 1, where: { slug: $slug }) {
				items {
					...SpeakerDetailFragment
				}
			}
		}
	`,
	[speakerDetailFragment],
);

const data = await client.request(query, {
	slug: slug as string,
});

const speaker = data.detail?.items[0];

// TODO: double check if this is correct
if (!speaker || !speaker.name) {
	return {
		status: 404,
		error: "Page not found",
	};
}
---

<ContentLayout title={speaker.name} backLinkTitle="Speakers" displayBacklink>
	<div class="talk">
		<TalkDetail />
	</div>
	<aside class="speaker">
		<SpeakerDetail speaker={speaker} />
	</aside>
</ContentLayout>

<style lang="scss">
	@import "../../styles/_imports.scss";

	@include breakpoint-up("lg") {
		.talk {
			grid-column: 1 / span 7;
		}

		.speaker {
			grid-column: 8 / span 5;
			margin-block-start: var(--spacing-20x);
		}
	}

	@include breakpoint-up("xl") {
		.talk {
			grid-column: 2 / span 6;
		}

		.speaker {
			grid-column: 9 / span 4;
		}
	}
</style>
