---
import { graphql } from "gql.tada";
import Hero from "../../layouts/Hero.astro";
import Layout from "../../layouts/Layout.astro";
import { client } from "../../utils/graphql-client";

const { speaker: slug } = Astro.params;

const query = graphql(`
  query GetSpeaker($slug: String!) {
    speakerCollection(limit: 1, where: { slug: $slug }) {
      items {
        name
        description
      }
    }
  }
`);

const data = await client.request(query, {
  slug: slug as string,
});

const speaker = data.speakerCollection?.items[0];

// TODO: double check if this is correct
if (!speaker || !speaker.name) {
  return {
    status: 404,
    error: "Page not found",
  };
}
---

<Layout title={speaker.name}>
  <Hero title={speaker.name} displayBacklink />
  <p>{speaker.description}</p>
</Layout>
